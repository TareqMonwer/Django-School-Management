{% extends 'dashboard.html' %}

{% block dashboard-body %}
<div class="container-fluid">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{% url 'index_view' %}">Dashboard</a></li>
      <li class="breadcrumb-item active" aria-current="page">User Requests</li>
    </ol>
  </nav>

  <h4>User Requests</h4>

  {% if messages %}
      {% for message in messages %}
      <div class="alert {{ message.tags }} alert-dismissible fade show" role="alert">
      <strong>{{ message }}</strong>
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
      </button>
      </div>
      {% endfor %}
  {% endif %}

  <div class="table-responsive">
    <table class="table table-hover">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Email</th>
          <th scope="col">ID</th>
          <th scope="col">Approval Status</th>
          <th scope="col">Requested Role</th>
          <th scope="col">Approval Action</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <th scope="row">{{ forloop.counter }}</th>
          <td>{{ user }}</td>
          <td>{{ user.employee_or_student_id }}</td>
          {% with req_role=user.approval_status %}
            <td class="{% if req_role == 'd' %}bg-warning{% endif %}">
              {{ user.get_approval_status_display }}
            </td>
          {% endwith %}
          <td>{{ user.get_requested_role_display }}</td>
          <td>
            <form class="d-inline" method="post"
              action="{% url account_urls.user_approval pk=user.pk approved=1 %}">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-success">Approve</button>
            </form>
            <a
              href="{% url account_urls.approval_with_modification pk=user.pk %}"
              class="btn btn-sm btn-primary"
              data-user-pk="{{ user.pk }}">
              Modify &amp; Approve
            </a>
            <form class="d-inline" method="post"
              action="{% url account_urls.user_approval pk=user.pk approved=0 %}">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-danger">Decline</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-center text-muted py-4">No pending user requests.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock dashboard-body %}
